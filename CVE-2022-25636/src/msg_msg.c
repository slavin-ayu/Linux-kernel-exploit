#include <sys/ipc.h>
#include <sys/msg.h>

#include "log.h"
#include "msg_msg.h"

int msqid[NUM_MSQIDS];

void init_msq() {
    for (int i = 0; i < NUM_MSQIDS; i++) {
        msqid[i] = msgget(IPC_PRIVATE, IPC_CREAT | 0666);
        if (msqid[i] < 0) {
            die("msgget");
        }
    }
    logd("init msq...");
}

void clear_msq(struct typ_msg *msgp, size_t msgsz, long mtype) {
    for (int i = 0; i < NUM_MSQIDS; i++) {
        msgrcv(msqid[i], (void *)msgp, msgsz, mtype, IPC_NOWAIT);
    }
}
