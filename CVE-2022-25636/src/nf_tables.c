#include <stdint.h>

#include <libmnl/libmnl.h>
#include <libnftnl/table.h>
#include <libnftnl/chain.h>
#include <libnftnl/rule.h>
#include <libnftnl/expr.h>

#include "nf_tables.h"

void rule_add_dup_netdev(struct nftnl_rule *r, uint32_t sreg) {

    struct nftnl_expr *e = nftnl_expr_alloc("dup");
    
    nftnl_expr_set_u32(e, NFTNL_EXPR_DUP_SREG_DEV, sreg);
    
    nftnl_rule_add_expr(r, e);
}

void rule_add_immediate(struct nftnl_rule *r, uint32_t dreg)
{
    struct nftnl_expr *e;

    e = nftnl_expr_alloc("immediate");

    nftnl_expr_set_u32(e, NFTNL_EXPR_IMM_DREG, dreg);
    nftnl_expr_set_u32(e, NFTNL_EXPR_IMM_DATA, 1);

    nftnl_rule_add_expr(r, e);
}